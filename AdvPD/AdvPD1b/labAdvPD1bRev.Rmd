---
title: "Visualizations with ggplot2"
author: "Advanced PD Lab 2B"
date: "The following slides contain information and examples about how to create visualizations using ggplot2. You will need your ggplot2 CHEAT SHEET."
output: 
  slidy_presentation: 
    css: ../../IDSLabCSSRev.css
    mathjax: ../../extras/mathjax-local/MathJax.js
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, eval=TRUE, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
library(mobilizr)
mpg<- mutate(mpg,cyl=as.factor(cyl))
```

## What is ggplot2?

The ggplot2 package, created by <a href="http://hadley.nz/">Hadley Wickham</a>, Chief Scientist at RStudio, offers a powerful graphics language for creating elegant and complex plots.  

ggplot2 allows you to create graphs that represent both univariate and multivariate numerical and categorical data in a straightforward manner.  

**Let's get started:** 

Begin by installing and loading the `ggplot2` package.  

`install.packages(" ")`  

`library(" ")`

### Consider Data:  

Load and preview the `mpg` data. 

 
## Categorical Variable  

The template to create a visual in ggplot looks like:  




    ggplot(data = < DATA >) +  

    < GEOM_FUNCTION >(mapping = aes(< MAPPINGS >))  
    
    


**Try these codes in an RScript or RMarkdown:**  


```{r, eval=FALSE, echo=TRUE}
ggplot(data = mpg) +
  geom_bar(mapping = aes(x = class))
```



The following arguments can be applied to change the color of a visual: `color, fill`  



```{r, eval=FALSE, echo=TRUE}
ggplot(data = mpg) +
  geom_bar(mapping = aes(x = class), fill="steelblue")
```

**Replace the `fill` argument with `color` and explain how it affects the visual.**  


**Match the graph**


```{r, eval=TRUE, echo=FALSE}
ggplot(data = mpg) +
  geom_bar(mapping = aes(x = class), fill="white",color="black")
```

The `fill` argument can also be used to assign colors to each category of a categorical variable (similar to what the groups argument does in lattice).  Notice that the argument needs to be contained within the aesthetics.  

```{r, eval=TRUE, echo=TRUE}
ggplot(data = mpg) +
  geom_bar(mapping = aes(x = class, fill=class))
```


Let's add more layers to this visual. 

Functions from <b>Scales</b>, <b>Labels</b>, <b>Coordinate Systems</b> and <b>Themes</b> have been applied to modify the visual.  

```{r, eval=TRUE, echo=TRUE}
ggplot(data = mpg) +
  geom_bar(mapping = aes(x = class, fill = class)) +
  scale_y_continuous(breaks = seq(0, 70, 5))+
  labs(title ="Distribution of Class") +
  coord_flip ()+
  theme_classic ()
```

**Flex Your Skills:** 

Modify the visual above by changing the scale, including additional labels and changing the theme.


## Comparing Groups on a Categorical Variable

<b> Is there a difference in the number of cylinders between types of cars?</b>

In order to create a visual to compare groups using lattice, we utilized the vertical bar (`|`) to split or facet each groups' data into a separate graph. The `groups` argument color coded the groups.

ggplot2 offers similar options with their `Faceting` and `Position Adjustment` options.  

<B>NOTE:</b> If you look at the structure of the mpg data you will find that the variable `cyl`is being interpreted as an integer. We, however, are utilizing it more as a categorical variable so we need to mutate the data using the following code:

```{r, echo=TRUE}
mpg<-mutate(mpg, cyl=as.factor(cyl))
```

<b>Faceting</b>

**Try this code in an RScript or RMarkdown:** 

```{r, eval=FALSE, echo=TRUE}
ggplot(data = mpg) +
  geom_bar(mapping = aes(x = cyl,fill=cyl))+
  facet_grid(.~class)
```

**Match the graph below**  

```{r, eval=TRUE, echo=FALSE}
ggplot(data = mpg) +
  geom_bar(mapping = aes(x = cyl,fill=cyl))+
  facet_wrap(~class)
```

<b>Position Adjustments</b>  

**Try this code in an RScript or RMarkdown:** 


```{r, eval=FALSE, echo=TRUE}
ggplot(data = mpg) +
  geom_bar(mapping = aes(x = class,fill=cyl),position="dodge")
```

**Match the graphs below**  

```{r, eval=TRUE, echo=FALSE}
ggplot(data = mpg) +
  geom_bar(mapping = aes(x = class,fill=cyl),position="stack")
```

```{r, eval=TRUE, echo=FALSE}
ggplot(data = mpg) +
  geom_bar(mapping = aes(x = class,fill=cyl),position="fill")
```

## Numerical Variable  

<b>Refer to your ggplot2 CHEAT SHEET: ONE VARIABLE continuous</b>

The template to create a visual in ggplot looks like:  

    ggplot(data = < DATA >) +  

    < GEOM_FUNCTION >(mapping = aes(< MAPPINGS >))  
    
**Match the graph**  

```{r, eval=TRUE, echo=FALSE}
ggplot(data=mpg)+
  geom_histogram(mapping=aes(x=cty),binwidth = 2)+
  geom_dotplot(mapping=aes(x=cty),fill="white",binwidth = 0.5)
```

<b>Density Plots</b>

Since the 18th century histograms have been a popular visualization option because they were easily generated by hand.  However, we see them increasingly being replaced by density plots.  

One advantage density plots have over histograms is that they are better at determining the shape of a distribution.  

Density curves are usually scaled such that the area under the curve equals one. This convention can make the y axis scale confusing, because it depends on the units of the x axis. The values of the y-axis aren't important. What is important is seeing the "shape" of the data.  


**Match the graph**  

```{r, eval=TRUE, echo=FALSE}
ggplot(data=mpg)+
  geom_density(mapping = aes(x=cty),fill="blue")
```

<b>Binwidth vs. Bandwidth</b>  

Turning the bandwith (`bw`) down in a density plot results in a spikier plot. This is similar to increasing the number of bins in a histogram.  

Turning the bandwith (`bw`) up in a density plot results in a smoother plot. This is similar to decreasing the number of bins in a histogram.  

**Match the graph**  

```{r, eval=TRUE, echo=FALSE}
ggplot(data=mpg)+
  geom_density(mapping = aes(x=cty),color="blue",bw=0.5)
```


## Comparing Groups on a Numerical Variable  

<b>How do highway miles per gallon compare between types of cars?</b>  

**Match the Graphs**

```{r, eval=TRUE, echo=FALSE}
ggplot(data=mpg)+
  geom_density(mapping=aes(x=hwy,color=class))
```


```{r, eval=TRUE, echo=FALSE}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=class,y=hwy))+
  geom_boxplot(mapping=aes(x=class,y=hwy,color=class))+
  scale_y_continuous(breaks=seq(0,45,5))
```



## Bivariate Data  

<b>Is there a difference between city miles per gallon and highway miles per gallon?</b>  

In order to help us answer this question we need to add the equation y = x to our scatterplot. The line y = x represents when hwy mileage = cty mileage (no difference).  

**Match the Graph**

```{r, eval=TRUE, echo=FALSE }
ggplot(data=mpg)+
  geom_point(mapping=aes(x=cty,y=hwy))+
  geom_abline(intercept = 0, slope = 1, color="red")
```

<b>What is the relationship between highway mileage and displacement?</b>  

```{r, eval=TRUE, echo=FALSE}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy))
```

Notice that as engine displacement increases, highway miles per gallon decreases. There are a few observations, however, that don't quite fit the pattern.  

Try the codes below: determine which variable explains these outliers.  

```{r, eval=FALSE, echo=TRUE}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy,shape=cyl))
```

```{r, eval=FALSE, echo=TRUE}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy,size=year))
```

```{r, eval=FALSE, echo=TRUE}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy,color=fl))
```

```{r, eval=FALSE, echo=TRUE}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy,color=class))
```
